---
const FormId = import.meta.env.PUBLIC_FORMCARRY_ENDPOINT;
---

<dialog id="js-contactDialog">
  <button id="js-closeContactBtn">XXXX</button>

  <h2>CONTACT</h2>

  <form
    method="dialog"
    action={`https://formcarry.com/s/${FormId}`}
    method="POST"
    novalidate
  >
    <label>
      <p>返信用メールアドレス</p>
      <input
        id="js-email"
        type="email"
        name="email"
        placeholder="hoge@mail.com"
        required
        autofocus
      />
    </label>

    <label>
      <p>お問い合わせ内容</p>
      <textarea
        id="js-message"
        placeholder="お問い合わせ内容"
        rows="6"
        required
        minlength="10"
        maxlength="800"></textarea>
    </label>

    <button id="js-submit" type="submit" disabled>送信</button>
    <p id="js-errorText" style="color: red;"></p>
  </form>
</dialog>

<script>
  document.addEventListener(
    "astro:page-load",
    () => {
      const emailInput = document.getElementById("js-email");
      const messageInput = document.getElementById("js-message");
      const errorText = document.getElementById("js-errorText");
      const submitButton = document.getElementById("js-submit");

      emailInput?.addEventListener("input", validateForm);
      messageInput?.addEventListener("input", validateForm);

      function validateForm() {
        if (!emailInput?.checkValidity()) {
          errorText.textContent = "正しい形式のEmailを入力してください。";
          submitButton.setAttribute("disabled", "");
        } else if (!messageInput?.checkValidity()) {
          errorText.textContent =
            "10文字以上、800文字以下のお問い合わせ内容を入力してください。";
          submitButton.setAttribute("disabled", "");
        } else {
          errorText.textContent = "";
          submitButton.removeAttribute("disabled");
        }
      }
    },
    { once: false },
  );
</script>

<style>
  dialog {
    margin: auto;
    padding: 24px;
    border: 0;
    border-radius: 0.6rem;
    box-shadow: 0 0 1em black;
    /* overscroll-behavior: contain; */
  }

  dialog::backdrop {
    background-color: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(4px);
  }

  form {
    display: flex;
    flex-direction: column;
  }

  input,
  textarea {
    /* border: 2px dashed yellow; */
  }

  button:disabled {
    opacity: 0.2;
  }
</style>
